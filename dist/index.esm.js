import t from"path";import e from"fs";import{ObjectId as r,MongoClient as n}from"mongodb";import a from"buffer";import o from"os";import u from"http";import i from"jsonwebtoken";import s from"crypto";function c(t,e,r,n,a,o,u){try{var i=t[o](u),s=i.value}catch(t){return void r(t)}i.done?e(s):Promise.resolve(s).then(n,a)}function f(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function u(t){c(o,n,a,u,i,"next",t)}function i(t){c(o,n,a,u,i,"throw",t)}u(void 0)}))}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,r){return e&&p(t.prototype,e),r&&p(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var v={exports:{}},y={exports:{}};!function(t){var e=function(t){var e,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var a=e&&e.prototype instanceof y?e:y,o=Object.create(a.prototype),u=new j(n||[]);return o._invoke=function(t,e,r){var n=l;return function(a,o){if(n===h)throw new Error("Generator is already running");if(n===d){if("throw"===a)throw o;return P()}for(r.method=a,r.arg=o;;){var u=r.delegate;if(u){var i=T(u,r);if(i){if(i===v)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var s=f(t,e,r);if("normal"===s.type){if(n=r.done?d:p,s.arg===v)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n=d,r.method="throw",r.arg=s.arg)}}}(t,r,u),o}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l="suspendedStart",p="suspendedYield",h="executing",d="completed",v={};function y(){}function b(){}function g(){}var m={};s(m,o,(function(){return this}));var S=Object.getPrototypeOf,w=S&&S(S(R([])));w&&w!==r&&n.call(w,o)&&(m=w);var E=g.prototype=y.prototype=Object.create(m);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(a,o,u,i){var s=f(t[a],t,o);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,u,i)}),(function(t){r("throw",t,u,i)})):e.resolve(l).then((function(t){c.value=t,u(c)}),(function(t){return r("throw",t,u,i)}))}i(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function T(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var a=f(n,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function R(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,u=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return u.next=u}}return{next:P}}function P(){return{value:e,done:!0}}return b.prototype=g,s(E,"constructor",g),s(g,"constructor",b),b.displayName=s(g,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s(t,i,"GeneratorFunction")),t.prototype=Object.create(E),t},t.awrap=function(t){return{__await:t}},O(x.prototype),s(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var u=new x(c(e,r,n,a),o);return t.isGeneratorFunction(r)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},O(E),s(E,i,"Generator"),s(E,o,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=R,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return i.type="throw",i.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var u=this.tryEntries[o],i=u.completion;if("root"===u.tryLoc)return a("end");if(u.tryLoc<=this.prev){var s=n.call(u,"catchLoc"),c=n.call(u,"finallyLoc");if(s&&c){if(this.prev<u.catchLoc)return a(u.catchLoc,!0);if(this.prev<u.finallyLoc)return a(u.finallyLoc)}else if(s){if(this.prev<u.catchLoc)return a(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return a(u.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var u=o?o.completion:{};return u.type=t,u.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(u)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;A(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:R(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(y);var b=d(v.exports=y.exports);function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function m(t,e){if(t){if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}function S(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||m(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,a,o=[],u=!0,i=!1;try{for(r=r.call(t);!(u=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);u=!0);}catch(t){i=!0,a=t}finally{try{u||null==r.return||r.return()}finally{if(i)throw a}}return o}}(t,e)||m(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var x={compareTwoStrings:T,findBestMatch:function(t,e){if(!function(t,e){return"string"==typeof t&&(!!Array.isArray(e)&&(!!e.length&&!e.find((function(t){return"string"!=typeof t}))))}(t,e))throw new Error("Bad arguments: First argument should be a string, second should be an array of strings");const r=[];let n=0;for(let a=0;a<e.length;a++){const o=e[a],u=T(t,o);r.push({target:o,rating:u}),u>r[n].rating&&(n=a)}const a=r[n];return{ratings:r,bestMatch:a,bestMatchIndex:n}}};function T(t,e){if((t=t.replace(/\s+/g,""))===(e=e.replace(/\s+/g,"")))return 1;if(t.length<2||e.length<2)return 0;let r=new Map;for(let e=0;e<t.length-1;e++){const n=t.substring(e,e+2),a=r.has(n)?r.get(n)+1:1;r.set(n,a)}let n=0;for(let t=0;t<e.length-1;t++){const a=e.substring(t,t+2),o=r.has(a)?r.get(a):0;o>0&&(r.set(a,o-1),n++)}return 2*n/(t.length+e.length-2)}var k={REQUEST:{BEFORE:{RESPONSE:"REQUEST.BEFORE.RESPONSE",PROCESS:"REQUEST.BEFORE.PROCESS"}}};function A(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return j(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var R={},P=function(){function t(e){var r=this;return l(this,t),O(this,"run",f(b.mark((function t(){var e,n,a,o,u=arguments;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=R[r.event],!1!==Array.isArray(e)){t.next=3;break}return t.abrupt("return",!1);case 3:n=A(e),t.prev=4,n.s();case 6:if((a=n.n()).done){t.next=19;break}return o=a.value,t.prev=8,t.next=11,Promise.resolve(o.apply(void 0,u));case 11:t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(8),logger(t.t0),t.abrupt("return",!1);case 17:t.next=6;break;case 19:t.next=24;break;case 21:t.prev=21,t.t1=t.catch(4),n.e(t.t1);case 24:return t.prev=24,n.f(),t.finish(24);case 27:return t.abrupt("return",!0);case 28:case"end":return t.stop()}}),t,null,[[4,21,24,27],[8,13]])})))),this.event=e,!1===Array.isArray(R[e])&&(R[e]=[]),this}return h(t,[{key:"set",value:function(e){return t.setListener(this.event,e)}},{key:"remove",value:function(e){return t.removeListener(this.event,e)}}],[{key:"setListener",value:function(t,e){return R[t].push(e)-1}},{key:"removeListener",value:function(t,e){try{R[t].filter((function(t,r){return e!==r}));return!0}catch(t){return!1}}}]),t}(),I={ROUTES:{DOCS:"/system/docs/*",API:"/system/docs/api"}},N={".ico":"image/x-icon",".html":"text/html",".js":"text/javascript",".json":"application/json",".css":"text/css",".png":"image/png",".jpg":"image/jpeg",".wav":"audio/wav",".mp3":"audio/mpeg",".svg":"image/svg+xml",".pdf":"application/pdf",".doc":"application/msword",".eot":"application/vnd.ms-fontobject",".ttf":"application/font-sfnt"},D={TYPES:{OATH:"oauth",JWT:"jwt"},ROUTES:{LOGIN:["POST","/system/auth"]},PERMISSIONS:{INSERT:"insert",UPDATE:"update",DELETE:"delete",LIST:"list",GET:"get"},PERMISSIONS_BY_METHODS:{POST:["insert"],PATCH:["update"],DELETE:["delete"],LIST:["list"],GET:["get"]}};[].concat(S(Object.values(D.ROUTES).map((function(t){return t[1]}))),S(Object.values(I.ROUTES)));var L={SERVER:{METHODS:{INSERT:"POST",UPDATE:"PATCH",DELETE:"DELETE",LIST:"GET",GET:"GET",POST:"POST",PATCH:"PATCH",ALL:"/*"},EVENTS:k,AUTH:D,DOCS:I,SECRET:"DEFAUL-SECRET-JSON-SERVER",TYPES:{REST:"rest",SOCKET:"socket"},FORMATS:{JSON:"json",CSV:"csv"},SETTINGS:{DATABASE:{DEFAULT:"custom-db",AUTH:"json-server-auth"},REQUEST:{LIMIT:10},LANGUAGE:{DEFAULT:"pt"}}}};function C(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return M(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function U(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function B(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?U(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}global.CONSTANTS=L;var H={},F={public:!0},G=function(){function t(){var e=this;l(this,t),O(this,"run",function(){var t=f(b.mark((function t(e,r){var n,a,o,u,i,s,c,f,l,p,h,d,v;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=function(){return n.length>0&&!1===n.includes(!1)},n=[],t.prev=2,o=B(B({},H[e.method]),H[L.SERVER.METHODS.ALL]),u=0===e.url.base.length?"/":e.url.base,t.t0=b.keys(o);case 6:if((t.t1=t.t0()).done){t.next=31;break}if(i=t.t1.value,u!==i){t.next=29;break}s=C(o[i]),t.prev=10,s.s();case 12:if((c=s.n()).done){t.next=21;break}return f=c.value.callback,t.t2=n,t.next=17,Promise.resolve(f(e,r)).catch(logger);case 17:t.t3=t.sent,t.t2.push.call(t.t2,t.t3);case 19:t.next=12;break;case 21:t.next=26;break;case 23:t.prev=23,t.t4=t.catch(10),s.e(t.t4);case 26:return t.prev=26,s.f(),t.finish(26);case 29:t.next=6;break;case 31:if(0!==n.length){t.next=54;break}if(l=Object.keys(o).map((function(t){return{score:x.compareTwoStrings(t,u),key:t}})).sort((function(t,e){return t.score-e.score})).pop(),p=l.key,!(l.score>.7)){t.next=54;break}h=C(o[p]),t.prev=35,h.s();case 37:if((d=h.n()).done){t.next=46;break}return v=d.value.callback,t.t5=n,t.next=42,Promise.resolve(v(e,r)).catch(logger);case 42:t.t6=t.sent,t.t5.push.call(t.t5,t.t6);case 44:t.next=37;break;case 46:t.next=51;break;case 48:t.prev=48,t.t7=t.catch(35),h.e(t.t7);case 51:return t.prev=51,h.f(),t.finish(51);case 54:return t.abrupt("return",a());case 57:return t.prev=57,t.t8=t.catch(2),logger(t.t8),t.abrupt("return",a());case 61:case"end":return t.stop()}}),t,null,[[2,57],[10,23,26,29],[35,48,51,54]])})));return function(e,r){return t.apply(this,arguments)}}()),O(this,"getArgs",(function(t){var e=E(t,2);return{method:e[0],path:e[1],options:"object"===w(t[2])?t[2]:F,callback:"function"==typeof t[3]?t[3]:t[2]}})),O(this,"register",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=e.getArgs(r),o=a.method,u=a.path,i=a.options,s=a.callback;void 0===H[o]&&(H[o]={}),!1===Array.isArray(H[o][u])&&(H[o][u]=[]),H[o][u].push({options:i,callback:s})})),O(this,"use",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r,o=E(a,1),u=o[0],i=Object.values(L.SERVER.METHODS).includes(u);!1===i&&(r=[L.SERVER.METHODS.ALL].concat(S(r))),e.register.apply(e,S(r))})),O(this,"get",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.register.apply(e,[L.SERVER.METHODS.GET].concat(r))})),O(this,"post",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.register.apply(e,[L.SERVER.METHODS.POST].concat(r))})),O(this,"patch",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.register.apply(e,[L.SERVER.METHODS.PATCH].concat(r))})),O(this,"delete",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.register.apply(e,[L.SERVER.METHODS.DELETE].concat(r))}))}return h(t,null,[{key:"getRequests",value:function(){var t=[];for(var e in H)for(var r in H[e])t.push({options:H[e][r][0].options,method:e,path:r});return t}},{key:"inWhitelist",value:function(e){return!!t.getRequests().find((function(t){var r=t.path===e.url.base&&t.method===e.method,n=e.url.base.search(t.path.replace("/*",""))>-1&&t.path.search(L.SERVER.METHODS.ALL)>-1&&"/"!==t.path;return(r||n)&&!1!==t.options.public}))}}]),t}();function V(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function q(t,e){return q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},q(t,e)}function $(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&q(t,e)}function _(t,e){if(e&&("object"===w(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return V(t)}function Q(t){return Q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Q(t)}function Y(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return J(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var W=function(){function r(n){var a=this;l(this,r),O(this,"writeFile",(function(t){return e.writeFileSync(a.filePath,JSON.stringify(t,null,2))})),O(this,"readFile",(function(){return e.existsSync(a.filePath)?JSON.parse(e.readFileSync(a.filePath,"utf8")):(e.writeFileSync(a.filePath,"{}"),{})})),O(this,"getAll",(function(){return a.db=a.readFile(),a.db[a.name][a.entity]})),O(this,"setAll",(function(t){a.db=t,a.writeFile(t)})),O(this,"add",(function(t){!1===Array.isArray(a.db[a.name][a.entity])&&(a.db[a.name][a.entity]=[]),a.db[a.name][a.entity].push(t),a.writeFile(a.db)})),O(this,"set",(function(t){a.db[a.name][a.entity]=t,a.writeFile(a.db)})),O(this,"find",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=a.getAll(),r=Object.keys(t),n=[];if(0===r.length)return e;var o,u=Y(e);try{var i=function(){var e=o.value,a=[];r.forEach((function(r){e[r]===t[r]&&a.push(!0)})),a.length===r.length&&n.push(e)};for(u.s();!(o=u.n()).done;)i()}catch(t){u.e(t)}finally{u.f()}return n})),O(this,"indexOf",(function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Object.keys(e),n=0,o=Y(a.getAll());try{var u=function(){var a=t.value,o=[];if(r.forEach((function(t){a[t]===e[t]&&o.push(!0)})),o.length===r.length)return{v:n};n++};for(o.s();!(t=o.n()).done;){var i=u();if("object"===w(i))return i.v}}catch(t){o.e(t)}finally{o.f()}return-1})),this.filePath=t.join(process.cwd(),"db.json"),this.name=n,this.db=this.readFile()}return h(r,[{key:"setEntity",value:function(t){this.entity=t}}]),r}();function z(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return K(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function X(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Z(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?X(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var tt=h((function t(){var e=this;l(this,t),O(this,"list",f(b.mark((function t(){var r,n,a,o,u=arguments;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=u.length>0&&void 0!==u[0]?u[0]:{},n=u.length>1&&void 0!==u[1]?u[1]:0,t.prev=2,a=e.storage.find(r),o=CONSTANTS.SERVER.SETTINGS.REQUEST.LIMIT+n,t.abrupt("return",a.slice(n,o));case 8:return t.prev=8,t.t0=t.catch(2),logger(t.t0),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,null,[[2,8]])})))),O(this,"find",function(){var t=f(b.mark((function t(r){var n,a,o;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.storage.find(r);case 3:return n=t.sent,a=E(n,1),o=a[0],t.abrupt("return",o||!1);case 9:return t.prev=9,t.t0=t.catch(0),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}()),O(this,"findByID",function(){var t=f(b.mark((function t(r){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.find({id:r});case 3:if(t.t0=t.sent,t.t0){t.next=6;break}t.t0=!1;case 6:return t.abrupt("return",t.t0);case 9:return t.prev=9,t.t1=t.catch(0),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}()),O(this,"insert",function(){var t=f(b.mark((function t(n){var a,o;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=new Date,o=Z({updated:a,created:a,id:r()},n),e.storage.add(o),t.abrupt("return",o);case 7:return t.prev=7,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()),O(this,"insertMany",function(){var t=f(b.mark((function t(n){var a,o,u,i,s,c;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,a=new Date,o=[],u=z(n);try{for(u.s();!(i=u.n()).done;)s=i.value,c=Z({updated:a,created:a,id:r()},s),e.storage.add(c),o.push(c)}catch(t){u.e(t)}finally{u.f()}return t.abrupt("return",o);case 8:return t.prev=8,t.t0=t.catch(0),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}()),O(this,"update",function(){var t=f(b.mark((function t(r,n){var a,o;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!((a=e.storage.indexOf(r))<0)){t.next=4;break}return t.abrupt("return",!1);case 4:return(o=e.storage.getAll())[a]=Z(Z({},o[a]),n),e.storage.set(o),t.abrupt("return",{modifiedCount:1});case 10:return t.prev=10,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e,r){return t.apply(this,arguments)}}()),O(this,"updateByID",function(){var t=f(b.mark((function t(r,n){var a;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.update({id:r},n);case 3:return a=t.sent,t.abrupt("return",a);case 7:return t.prev=7,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,r){return t.apply(this,arguments)}}()),O(this,"updateMany",function(){var t=f(b.mark((function t(e,r){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",!1);case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),O(this,"delete",function(){var t=f(b.mark((function t(r){var n;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.storage.find(r).map((function(t){return JSON.stringify(t)})),e.storage.set(e.storage.getAll().filter((function(t){return!n.includes(JSON.stringify(t))}))),t.abrupt("return",{deletedCount:n.length});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),O(this,"deleteByID",function(){var t=f(b.mark((function t(r){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.delete({id:r});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),O(this,"deleteMany",function(){var t=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",!1);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),O(this,"getLatest",function(){var t=f(b.mark((function t(r){var n,a,o,u=arguments;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:0,a=e.storage.find(r),o=CONSTANTS.SERVER.SETTINGS.REQUEST.LIMIT+n,t.abrupt("return",a.slice(n,o));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),O(this,"getOldest",function(){var t=f(b.mark((function t(r){var n,a,o,u=arguments;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:0,a=e.storage.find(r).reverse(),o=CONSTANTS.SERVER.SETTINGS.REQUEST.LIMIT+n,t.abrupt("return",a.slice(n,o));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}));function et(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Q(t);if(e){var a=Q(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _(this,r)}}var nt=function(t){$(r,tt);var e=rt(r);function r(t){var n,a=t.name,o=t.key;return l(this,r),O(V(n=e.call(this)),"connect",f(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",V(n));case 1:case"end":return t.stop()}}),t)})))),O(V(n),"setEntity",function(){var t=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.entity=e,t.next=3,n.storage.setEntity(e);case 3:void 0===n.storage.db[n.name][n.entity]&&n.storage.set([]);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),O(V(n),"count",f(b.mark((function t(){var e;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(null===(e=n.storage.db[n.name][n.entity])||void 0===e?void 0:e.length)||0);case 2:case"end":return t.stop()}}),t)})))),O(V(n),"validateID",function(){var t=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}return t.abrupt("return",!1);case 2:return t.abrupt("return",e.match(/^[0-9a-fA-F]{24}$/));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n.storage=new W(a),n.storage.db[a]||(n.storage.db[a]={}),n.name=a,n.key=o,n.storage.setAll(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?et(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):et(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},n.storage.db)),n}return h(r)}(),at={};function ot(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return ut(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ut(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function it(){return global["json-server"]||{}}function st(t){return void 0===t?[]:Array.isArray(t)?t:["string","number","boolean"].includes(w(t))||"object"===w(t)&&Object.keys(t).length>0?[t]:[]}function ct(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.id||t._id}function ft(t){return lt.apply(this,arguments)}function lt(){return lt=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.resolve(e());case 3:return t.abrupt("return",t.sent);case 6:t.prev=6,t.t0=t.catch(0);case 8:case"end":return t.stop()}}),t,null,[[0,6]])}))),lt.apply(this,arguments)}function pt(t,e){var r=e.fields;switch(t&&r?Array.isArray(t)?"array":"valid":"invalid"){case"invalid":return t;case"array":var n,a=[],o=ot(t);try{for(o.s();!(n=o.n()).done;){var u=n.value;a.push(pt(u,{fields:r}))}}catch(t){o.e(t)}finally{o.f()}return a;default:var i=Object.keys(r).filter((function(t){var e;return!0===(null===(e=r[t])||void 0===e?void 0:e.secure)}));return Object.keys(t).reduce((function(e,r){return!1===i.includes(r)&&(e[r]=t[r]),e}),{})}}function ht(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"http".concat(t.socket.encrypted?"s":"","://").concat(t.headers.host+e,"/")}function dt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return vt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vt(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function yt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function bt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?yt(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}!function(t){var e=t,r=a.Buffer,n=o;e.toBuffer=function(t,e,n){var a;if(n=~~n,this.isV4Format(t))a=e||new r(n+4),t.split(/\./g).map((function(t){a[n++]=255&parseInt(t,10)}));else if(this.isV6Format(t)){var o,u=t.split(":",8);for(o=0;o<u.length;o++){var i;this.isV4Format(u[o])&&(i=this.toBuffer(u[o]),u[o]=i.slice(0,2).toString("hex")),i&&++o<8&&u.splice(o,0,i.slice(2,4).toString("hex"))}if(""===u[0])for(;u.length<8;)u.unshift("0");else if(""===u[u.length-1])for(;u.length<8;)u.push("0");else if(u.length<8){for(o=0;o<u.length&&""!==u[o];o++);var s=[o,1];for(o=9-u.length;o>0;o--)s.push("0");u.splice.apply(u,s)}for(a=e||new r(n+16),o=0;o<u.length;o++){var c=parseInt(u[o],16);a[n++]=c>>8&255,a[n++]=255&c}}if(!a)throw Error("Invalid ip address: "+t);return a},e.toString=function(t,e,r){e=~~e;var n=[];if(4===(r=r||t.length-e)){for(var a=0;a<r;a++)n.push(t[e+a]);n=n.join(".")}else if(16===r){for(a=0;a<r;a+=2)n.push(t.readUInt16BE(e+a).toString(16));n=(n=(n=n.join(":")).replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3")).replace(/:{3,4}/,"::")}return n};var u=/^(\d{1,3}\.){3,3}\d{1,3}$/,i=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;function s(t){return t?t.toLowerCase():"ipv4"}e.isV4Format=function(t){return u.test(t)},e.isV6Format=function(t){return i.test(t)},e.fromPrefixLen=function(t,n){var a=4;"ipv6"===(n=t>32?"ipv6":s(n))&&(a=16);for(var o=new r(a),u=0,i=o.length;u<i;++u){var c=8;t<8&&(c=t),t-=c,o[u]=255&~(255>>c)}return e.toString(o)},e.mask=function(t,n){t=e.toBuffer(t),n=e.toBuffer(n);var a=new r(Math.max(t.length,n.length)),o=0;if(t.length===n.length)for(o=0;o<t.length;o++)a[o]=t[o]&n[o];else if(4===n.length)for(o=0;o<n.length;o++)a[o]=t[t.length-4+o]&n[o];else{for(o=0;o<a.length-6;o++)a[o]=0;for(a[10]=255,a[11]=255,o=0;o<t.length;o++)a[o+12]=t[o]&n[o+12];o+=12}for(;o<a.length;o++)a[o]=0;return e.toString(a)},e.cidr=function(t){var r=t.split("/"),n=r[0];if(2!==r.length)throw new Error("invalid CIDR subnet: "+n);var a=e.fromPrefixLen(parseInt(r[1],10));return e.mask(n,a)},e.subnet=function(t,r){for(var n=e.toLong(e.mask(t,r)),a=e.toBuffer(r),o=0,u=0;u<a.length;u++)if(255===a[u])o+=8;else for(var i=255&a[u];i;)i=i<<1&255,o++;var s=Math.pow(2,32-o);return{networkAddress:e.fromLong(n),firstAddress:s<=2?e.fromLong(n):e.fromLong(n+1),lastAddress:s<=2?e.fromLong(n+s-1):e.fromLong(n+s-2),broadcastAddress:e.fromLong(n+s-1),subnetMask:r,subnetMaskLength:o,numHosts:s<=2?s:s-2,length:s,contains:function(t){return n===e.toLong(e.mask(t,r))}}},e.cidrSubnet=function(t){var r=t.split("/"),n=r[0];if(2!==r.length)throw new Error("invalid CIDR subnet: "+n);var a=e.fromPrefixLen(parseInt(r[1],10));return e.subnet(n,a)},e.not=function(t){for(var r=e.toBuffer(t),n=0;n<r.length;n++)r[n]=255^r[n];return e.toString(r)},e.or=function(t,r){if(t=e.toBuffer(t),r=e.toBuffer(r),t.length===r.length){for(var n=0;n<t.length;++n)t[n]|=r[n];return e.toString(t)}var a=t,o=r;r.length>t.length&&(a=r,o=t);var u=a.length-o.length;for(n=u;n<a.length;++n)a[n]|=o[n-u];return e.toString(a)},e.isEqual=function(t,r){if(t=e.toBuffer(t),r=e.toBuffer(r),t.length===r.length){for(var n=0;n<t.length;n++)if(t[n]!==r[n])return!1;return!0}if(4===r.length){var a=r;r=t,t=a}for(n=0;n<10;n++)if(0!==r[n])return!1;var o=r.readUInt16BE(10);if(0!==o&&65535!==o)return!1;for(n=0;n<4;n++)if(t[n]!==r[n+12])return!1;return!0},e.isPrivate=function(t){return/^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(t)||/^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(t)||/^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(t)||/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(t)||/^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(t)||/^f[cd][0-9a-f]{2}:/i.test(t)||/^fe80:/i.test(t)||/^::1$/.test(t)||/^::$/.test(t)},e.isPublic=function(t){return!e.isPrivate(t)},e.isLoopback=function(t){return/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})/.test(t)||/^fe80::1$/.test(t)||/^::1$/.test(t)||/^::$/.test(t)},e.loopback=function(t){if("ipv4"!==(t=s(t))&&"ipv6"!==t)throw new Error("family must be ipv4 or ipv6");return"ipv4"===t?"127.0.0.1":"fe80::1"},e.address=function(t,r){var a,o=n.networkInterfaces();if(r=s(r),t&&"private"!==t&&"public"!==t){var u=o[t].filter((function(t){return t.family.toLowerCase()===r}));if(0===u.length)return;return u[0].address}return(a=Object.keys(o).map((function(n){var a=o[n].filter((function(n){return n.family=n.family.toLowerCase(),n.family===r&&!e.isLoopback(n.address)&&(!t||("public"===t?e.isPrivate(n.address):e.isPublic(n.address)))}));return a.length?a[0].address:void 0})).filter(Boolean)).length?a[0]:e.loopback(r)},e.toLong=function(t){var e=0;return t.split(".").forEach((function(t){e<<=8,e+=parseInt(t)})),e>>>0},e.fromLong=function(t){return(t>>>24)+"."+(t>>16&255)+"."+(t>>8&255)+"."+(255&t)}}(at);var gt=function(){function t(){l(this,t),this.entity=null,this.collection={}}var e,n,a,o,u,i,s,c,p,d,v,y,g,m;return h(t,[{key:"list",value:(m=f(b.mark((function t(){var e,r,n=arguments;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1&&void 0!==n[1]?n[1]:0,t.prev=2,t.next=5,this.collection.find(e).limit(CONSTANTS.SERVER.SETTINGS.REQUEST.LIMIT).skip(r).sort({updated:-1}).toArray();case 5:return t.abrupt("return",t.sent);case 8:return t.prev=8,t.t0=t.catch(2),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this,[[2,8]])}))),function(){return m.apply(this,arguments)})},{key:"find",value:(g=f(b.mark((function t(e){var r;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.findOne(e);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return g.apply(this,arguments)})},{key:"findByID",value:(y=f(b.mark((function t(e){var n;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.find({_id:r(e)});case 3:return n=t.sent,t.abrupt("return",n);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return y.apply(this,arguments)})},{key:"insert",value:(v=f(b.mark((function t(e){var r;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=new Date,t.next=4,this.collection.insertOne(bt({updated:r,created:r},e));case 4:return t.next=7,this.find(e);case 7:return t.abrupt("return",t.sent);case 10:return t.prev=10,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(t){return v.apply(this,arguments)})},{key:"insertMany",value:(d=f(b.mark((function t(e){var r,n,a;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=new Date,n=e.map((function(t){return bt(bt({},t),{},{updated:r,created:r})})),t.next=5,this.collection.insertMany(n);case 5:return a=t.sent,t.abrupt("return",a.ops);case 9:return t.prev=9,t.t0=t.catch(0),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(t){return d.apply(this,arguments)})},{key:"updateByID",value:(p=f(b.mark((function t(e,n){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.update({_id:r(e)},n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return p.apply(this,arguments)})},{key:"update",value:(c=f(b.mark((function t(e,r){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.updateOne(e,{$set:bt({updated:new Date},r)});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"updateMany",value:(s=f(b.mark((function t(e,r){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.updateMany(e,{$set:bt({updated:new Date},r)});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return s.apply(this,arguments)})},{key:"delete",value:(i=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.deleteOne(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"deleteByID",value:(u=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.delete({_id:r(e)});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"deleteMany",value:(o=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.deleteMany(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"getLatest",value:(a=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.find(e).limit(CONSTANTS.SERVER.SETTINGS.REQUEST.LIMIT).sort({$natural:-1}).toArray();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"getOldest",value:(n=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.find(e).limit(CONSTANTS.SERVER.SETTINGS.REQUEST.LIMIT).sort({$natural:1}).toArray();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"search",value:(e=f(b.mark((function t(e){var r,n,a,o,u,i,s,c=this,f=arguments;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=!(f.length>1&&void 0!==f[1])||f[1],n=it(),a=n.entities,o=[],u=dt(a),t.prev=4,s=b.mark((function t(){var r,n,a,u,s,f,l;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.value,n=r.name,a=r.fields,u=c.db.collection(n),s=Object.keys(a).filter((function(t){var e,r;return[a[t],null===(e=a[t])||void 0===e?void 0:e.type].includes("string")&&!0!==(null===(r=a[t])||void 0===r?void 0:r.secure)})),f={$text:{$diacriticSensitive:!1,$caseSensitive:!1,$search:e}},"string"!=typeof e&&(f=s.reduce((function(t,r){return t[r]=e,t}),{})),t.next=7,u.find(f).toArray();case 7:(l=t.sent).length>0&&o.push(l.map((function(t){return{type:n,record:t}})));case 9:case"end":return t.stop()}}),t)})),u.s();case 7:if((i=u.n()).done){t.next=11;break}return t.delegateYield(s(),"t0",9);case 9:t.next=7;break;case 11:t.next=16;break;case 13:t.prev=13,t.t1=t.catch(4),u.e(t.t1);case 16:return t.prev=16,u.f(),t.finish(16);case 19:if(0!==o.length||!r){t.next=21;break}return t.abrupt("return",this.search(new RegExp(e,"gi"),!1));case 21:return t.abrupt("return",o.flat());case 22:case"end":return t.stop()}}),t,this,[[4,13,16,19]])}))),function(t){return e.apply(this,arguments)})}]),t}();function mt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return St(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return St(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function St(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Q(t);if(e){var a=Q(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _(this,r)}}var Et=function(t){$(s,gt);var e,r,a,o,u,i=wt(s);function s(t){var e,r=t.uri,a=t.name,o=t.key;return l(this,s),(e=i.call(this)).client=new n(r),e.name=a,e.uri=r,e.key=o,e}return h(s,[{key:"createTextIndexes",value:(u=f(b.mark((function t(){var e,r,n,a;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=mt(it().entities),t.prev=1,e.s();case 3:if((r=e.n()).done){t.next=15;break}return n=r.value,t.prev=5,a=this.db.collection(n.name),t.next=9,a.createIndex({"$**":"text"},{default_language:CONSTANTS.SERVER.SETTINGS.LANGUAGE.DEFAULT});case 9:t.next=13;break;case 11:t.prev=11,t.t0=t.catch(5);case 13:t.next=3;break;case 15:t.next=20;break;case 17:t.prev=17,t.t1=t.catch(1),e.e(t.t1);case 20:return t.prev=20,e.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[1,17,20,23],[5,11]])}))),function(){return u.apply(this,arguments)})},{key:"connect",value:(o=f(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.client.connect();case 3:return this.db=this.client.db(this.name),t.next=6,this.createTextIndexes();case 6:return t.abrupt("return",this);case 9:return t.prev=9,t.t0=t.catch(0),console.log(t.t0),t.abrupt("return",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(){return o.apply(this,arguments)})},{key:"setEntity",value:(a=f(b.mark((function t(e){var r=this;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ft(f(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.db.createCollection(e);case 2:case"end":return t.stop()}}),t)}))));case 2:this.entity=e,this.collection=this.db.collection(e);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"count",value:(r=f(b.mark((function t(){var e,r=arguments;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:{},t.abrupt("return",this.collection.count(e));case 2:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"validateID",value:(e=f(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.match(/^[0-9a-fA-F]{24}$/));case 1:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})}]),s}();function Ot(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return xt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xt(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function xt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Tt={},kt=function(){function t(e){l(this,t),this.list=st(e.database),this.databases=Tt,0===this.list.length&&this.list.push({name:CONSTANTS.SERVER.SETTINGS.DATABASE.DEFAULT,key:CONSTANTS.SERVER.SETTINGS.DATABASE.DEFAULT,type:"custom"}),this.setup()}var e;return h(t,[{key:"setup",value:(e=f(b.mark((function t(){var e,r,n,a,o;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Ot(this.list),t.prev=1,e.s();case 3:if((r=e.n()).done){t.next=19;break}return n=r.value,t.prev=5,a=this.getClassByType(n.type),o=new a(n),t.next=10,o.connect();case 10:this.databases[n.key]=o,t.next=17;break;case 13:t.prev=13,t.t0=t.catch(5),logger(t.t0),this.databases[n.key]=t.t0;case 17:t.next=3;break;case 19:t.next=24;break;case 21:t.prev=21,t.t1=t.catch(1),e.e(t.t1);case 24:return t.prev=24,e.f(),t.finish(24);case 27:0===Object.keys(this.databases).length&&logger("No databases connected");case 28:case"end":return t.stop()}}),t,this,[[1,21,24,27],[5,13]])}))),function(){return e.apply(this,arguments)})},{key:"getClassByType",value:function(t){switch(t){case"mongo-db":case"mongodb":case"mongoDB":case"mongo":return Et;default:return nt}}},{key:"getDB",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:CONSTANTS.SERVER.SETTINGS.DATABASE.DEFAULT;return this.databases[t]}}],[{key:"get",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:CONSTANTS.SERVER.SETTINGS.DATABASE.DEFAULT;return Tt[t]}},{key:"closeAll",value:function(t){var e=[];for(var r in Tt){var n,a;"function"==typeof(null===(n=Tt[r])||void 0===n||null===(a=n.client)||void 0===a?void 0:a.close)&&(Tt[r].client.close(),e.push(r))}return e}}]),t}();function At(t,e){var r=e.fields,n=Object.keys(r).map((function(t){var e,n;return{type:(null===(e=r[t])||void 0===e?void 0:e.type)||w(r[t]),required:!(null===(n=r[t])||void 0===n||!n.required),key:t}})).filter((function(t){return t.required})).reduce((function(t,e){return e.required&&(t[e.key]=e.type),t}),{});for(var a in n)if(w(t[a])!==n[a])return!1;return!0}function jt(t){return t.splitted[1]}var Rt=function(t,e){return function(r){var n=r.url.splitted.filter((function(t){return t.length>0}));return r.method===CONSTANTS.SERVER.METHODS[t]&&e(n.length)}},Pt={delete:Rt("DELETE",(function(t){return 2===t})),update:Rt("UPDATE",(function(t){return 2===t})),insert:Rt("INSERT",(function(t){return 1===t})),list:Rt("LIST",(function(t){return 1===t})),get:Rt("GET",(function(t){return 2===t})),oldest:function(t){var e,r;return(null==t||null===(e=t.url)||void 0===e||null===(r=e.value)||void 0===r?void 0:r.search("oldest"))>-1&&(null==t?void 0:t.method)===CONSTANTS.SERVER.METHODS.GET},latest:function(t){var e,r;return(null==t||null===(e=t.url)||void 0===e||null===(r=e.value)||void 0===r?void 0:r.search("latest"))>-1&&(null==t?void 0:t.method)===CONSTANTS.SERVER.METHODS.GET}};function It(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return Nt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nt(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function Nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Dt=function(){function t(e,r){var n=this;l(this,t),O(this,"next",(function(t){return{response:n.response,code:t}})),O(this,"validateURL",f(b.mark((function t(){var e,r,a,o,u,i;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,e=it(),r=E(n.request.url.splitted,1),a=r[0],o=It(e.entities),t.prev=4,o.s();case 6:if((u=o.n()).done){t.next=16;break}if(i=u.value,!(a===i.name)){t.next=14;break}return n.entity=i,t.next=13,n.database.setEntity(i.name);case 13:return t.abrupt("return",200);case 14:t.next=6;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(4),o.e(t.t0);case 21:return t.prev=21,o.f(),t.finish(21);case 24:return t.abrupt("return",404);case 27:return t.prev=27,t.t1=t.catch(0),logger(t.t1),t.abrupt("return",500);case 31:case"end":return t.stop()}}),t,null,[[0,27],[4,18,21,24]])})))),O(this,"action",f(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Pt.oldest(n.request)){t.next=4;break}return t.next=3,n.oldest();case 3:case 7:case 11:case 15:case 19:case 23:case 27:return t.abrupt("return",t.sent);case 4:if(!Pt.latest(n.request)){t.next=8;break}return t.next=7,n.latest();case 8:if(!Pt.update(n.request)){t.next=12;break}return t.next=11,n.update();case 12:if(!Pt.delete(n.request)){t.next=16;break}return t.next=15,n.delete();case 16:if(!Pt.insert(n.request)){t.next=20;break}return t.next=19,n.insert();case 20:if(!Pt.list(n.request)){t.next=24;break}return t.next=23,n.list();case 24:if(!Pt.get(n.request)){t.next=28;break}return t.next=27,n.get();case 28:return t.abrupt("return",n.next(404));case 29:case"end":return t.stop()}}),t)})))),O(this,"list",f(b.mark((function t(){var e,r,a,o;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([n.database.list(),n.database.count()]);case 3:return e=t.sent,r=E(e,2),a=r[0],o=r[1],n.response={records:pt(a,n.request.entity),count:o},t.abrupt("return",n.next(200));case 11:return t.prev=11,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",n.next(500));case 15:case"end":return t.stop()}}),t,null,[[0,11]])})))),O(this,"get",f(b.mark((function t(){var e,r;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=n.request.url.splitted[1]+"",!1!==n.database.validateID(e)){t.next=4;break}return t.abrupt("return",n.next(404));case 4:return t.next=6,n.database.findByID(e);case 6:if(!1!==(r=t.sent)){t.next=9;break}return t.abrupt("return",n.next(204));case 9:return n.response=O({},n.entity.name,pt(r,n.request.entity)),t.abrupt("return",n.next(200));case 13:return t.prev=13,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",n.next(500));case 17:case"end":return t.stop()}}),t,null,[[0,13]])})))),O(this,"insert",f(b.mark((function t(){var e,r,a,o,u,i,s,c;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,e=n.request.body,r=!1===Array.isArray(e)?[e]:e,a=[],o=It(r),t.prev=5,o.s();case 7:if((u=o.n()).done){t.next=20;break}if(i=u.value,!1!==At(i,n.entity)){t.next=14;break}a.push(400),t.next=18;break;case 14:return t.next=16,n.database.insert(i);case 16:s=t.sent,a.push(!1===s?500:s);case 18:t.next=7;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(5),o.e(t.t0);case 25:return t.prev=25,o.f(),t.finish(25);case 28:if(!a.includes(400)){t.next=30;break}return t.abrupt("return",n.next(400));case 30:if(!a.includes(400)){t.next=32;break}return t.abrupt("return",n.next(500));case 32:return c=1===r.length?a[0]:a,n.response=O({},n.entity.name,pt(c,n.request.entity)),t.abrupt("return",n.next(200));case 37:return t.prev=37,t.t1=t.catch(0),logger(t.t1),t.abrupt("return",n.next(500));case 41:case"end":return t.stop()}}),t,null,[[0,37],[5,22,25,28]])})))),O(this,"delete",f(b.mark((function t(){var e,r;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=jt(n.request.url),!1!==n.database.validateID(e)){t.next=4;break}return t.abrupt("return",n.next(400));case 4:return t.next=6,n.database.deleteByID(e);case 6:if(!((null==(r=t.sent)?void 0:r.deletedCount)>0)){t.next=9;break}return t.abrupt("return",n.next(200));case 9:return n.response={message:"0 records deleted"},t.abrupt("return",n.next(200));case 13:return t.prev=13,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",n.next(500));case 17:case"end":return t.stop()}}),t,null,[[0,13]])})))),O(this,"update",f(b.mark((function t(){var e,r,a,o,u,i,s,c,f;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=jt(n.request.url),r=n.request.body,!1!==n.database.validateID(e)){t.next=5;break}return t.abrupt("return",n.next(400));case 5:for(a=Object.keys(n.entity.fields),o={},u=0,i=a;u<i.length;u++)s=i[u],r[s]&&(o[s]=r[s]);if(!(Object.keys(o).length<1)){t.next=10;break}return t.abrupt("return",n.next(400));case 10:return t.next=12,n.database.updateByID(e,o);case 12:if(!((null==(c=t.sent)?void 0:c.modifiedCount)<1)){t.next=16;break}return n.response={message:"No records updated"},t.abrupt("return",n.next(500));case 16:return t.next=18,n.database.findByID(e);case 18:return!1!==(f=t.sent)&&(n.response=O({},n.entity.name,pt(f,n.request.entity))),t.abrupt("return",n.next(200));case 23:return t.prev=23,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",n.next(500));case 27:case"end":return t.stop()}}),t,null,[[0,23]])})))),O(this,"oldest",f(b.mark((function t(){var e;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.database.getOldest();case 3:return e=t.sent,n.response={records:pt(e,n.request.entity)},t.abrupt("return",n.next(200));case 8:return t.prev=8,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",n.next(500));case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))),O(this,"latest",f(b.mark((function t(){var e;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.database.getLatest();case 3:return e=t.sent,n.response={records:pt(e,n.request.entity)},t.abrupt("return",n.next(200));case 8:return t.prev=8,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",n.next(500));case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))),this.request=e,this.response=null,this.entity={},this.database=kt.get(r)}var e;return h(t,[{key:"run",value:(e=f(b.mark((function t(){var e,r,n;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.request,r=e.method,t.next=3,this.validateURL();case 3:if(n=t.sent,!1!==Object.values(CONSTANTS.SERVER.METHODS).includes(r)){t.next=7;break}return t.abrupt("return",this.next(404));case 7:if(200===n){t.next=9;break}return t.abrupt("return",this.next(n));case 9:return t.next=11,this.action();case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),t}(),Lt=function(){function t(){l(this,t)}return h(t,null,[{key:"handle",value:function(t,e){return new Dt(t,e).run()}}]),t}(),Ct={200:{code:200,message:"OK"},204:{code:204,message:"No Content"},400:{code:400,message:"Bad Request"},401:{code:401,message:"Unauthorized"},403:{code:403,message:"Requested Resource Is Forbidden"},404:{code:404,message:"Not Found"},405:{code:405,message:"Method Not Allowed"},422:{code:422,message:"Unprocessable Entity"},429:{code:429,message:"Too Many Requests"},500:{code:500,message:"Server Error"}};function Mt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var Ut=function(){function t(){l(this,t)}return h(t,null,[{key:"get",value:function(t){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Mt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({status:[200,201].includes(t)},Ct[t])}}]),t}();function Bt(t){return JSON.stringify(t)}function Ht(t){var e;return!0===Array.isArray(t)?(e=t[0],t):(e=t,[t]),[e=Object.keys(e).join(","),t.map((function(t){return Object.values(t).join(",")})).join("\n")].join("\n")}function Ft(t){var e=[CONSTANTS.SERVER.METHODS.INSERT,CONSTANTS.SERVER.METHODS.UPDATE];return new Promise((function(r,n){var a="";if(!1===e.includes(t.method))return r({});t.on("data",(function(t){a+=t})),t.on("end",(function(){return r(JSON.parse(a))})),t.on("error",(function(t){return n(t)}))}))}function Gt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Vt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Gt(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Gt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}new P(k.REQUEST.BEFORE.PROCESS).set(function(){var t=f(b.mark((function t(e,r){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:it().cors&&(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","OPTIONS, POST, GET, PATCH, DELETE"),r.setHeader("Access-Control-Max-Age",2592e6),r.setHeader("Access-Control-Allow-Headers","Access-Control-Allow-Headers, Origin, Accept, X-Requested-With, X-Auth-Token, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers"),"OPTIONS"===e.method&&(r.statusCode=201));case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}());var qt,$t,_t=function(){function t(e){var r=this,n=e.format,a=e.port,o=e.type,u=e.database;return l(this,t),O(this,"handler",function(){var t=f(b.mark((function t(e,n){var a,o,u,i,s;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Ft(e);case 3:e.body=t.sent,t.next=9;break;case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return",r.parse(422));case 9:r.res=n,r.req=e,r.res.json=function(t){return r.res.payload=Vt(Vt({},Ut.get(200)),t),!0},r.res.code=function(t){return r.res.statusCode=t,!0},r.req.server={database:r.database,format:r.format,type:r.type,port:r.port},logger("REQUEST",e.method,e.url,e.body&&Object.keys(e.body).length>0||""),a=[new P(k.REQUEST.BEFORE.PROCESS),new G],o=0,u=a;case 17:if(!(o<u.length)){t.next=28;break}return i=u[o],t.next=21,i.run(r.req,r.res);case 21:if(!(200!==r.res.statusCode||"object"===w(r.res.payload))){t.next=25;break}return t.abrupt("return",r.parse(r.res.statusCode,r.res.payload));case 25:o++,t.next=17;break;case 28:return t.next=30,Lt.handle(r.req,r.database);case 30:if(200!==(s=t.sent).code){t.next=33;break}return t.abrupt("return",r.parse(s.code,s.response));case 33:if(404===s.code){t.next=35;break}return t.abrupt("return",r.parse(s.code,Ut.get(s.code)));case 35:return t.abrupt("return",r.handleNotFound());case 36:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e,r){return t.apply(this,arguments)}}()),this.database=u,this.format=n,this.type=o,this.port=a,this.handler}return h(t,[{key:"parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!!this.res.getHeader("Content-Type"),n=r?void 0:this.format;switch(n?this.response=Vt(Vt({},Ut.get(t)),e):Object.keys(e).length>0&&(this.response=e),n){case CONSTANTS.SERVER.FORMATS.CSV:this.res.setHeader("Content-Type","text/csv"),this.res.setHeader("Content-Disposition","attachment;filename=response.csv"),this.response=Ht(e);break;case CONSTANTS.SERVER.FORMATS.JSON:this.res.setHeader("Content-Type","application/json"),this.response=Bt(this.response)}return this.send()}},{key:"handleNotFound",value:function(){return this.parse(404,Ut.get(404))}},{key:"send",value:function(){var t,e=this;return logger("RESPONSE",this.req.method,this.res.statusCode,this.req.url.base,(null===(t=e.res.getHeader("Content-Type"))||void 0===t?void 0:t.search("json"))>-1?e.response:""),this.res.writeHead(this.res.statusCode,this.res.getHeaders()),this.response?this.res.end(this.response):this.res.end()}}]),t}(),Qt=h((function t(e){var r=this;l(this,t);var n=e.port;return e.type,e.format,this.port=n,this.host=at.address(),this.app=u.createServer(new _t(e)),this.app.listen(this.port,this.host,(function(){logger("Server running on http://".concat(r.host,":").concat(r.port))})),this})),Yt=function(){function t(e){e.entity;var r=e.server;l(this,t),qt=CONSTANTS.SERVER.SETTINGS.DATABASE.AUTH,$t=CONSTANTS.SERVER.SETTINGS.DATABASE.DEFAULT,this.server=r;try{this.database=kt.get((null==r?void 0:r.database)||$t),this.database.setEntity(qt)}catch(t){logger(t)}}var e,r;return h(t,[{key:"validate",value:(r=f(b.mark((function t(e){var r,n,a,o,u,i;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=(null==e?void 0:e.toLowerCase().search("bearer"))>-1?e.replace(new RegExp("bearer ","gi"),""):e,t.next=4,this.database.setEntity(qt);case 4:return t.next=6,this.database.find({token:n});case 6:if(null!=(a=t.sent)&&a.entity){t.next=9;break}return t.abrupt("return",[!1,!1]);case 9:return o=kt.get((null===(r=this.server)||void 0===r?void 0:r.database)||$t),t.next=12,o.setEntity(a.entity.type);case 12:return t.next=14,o.findByID(a.entity.id);case 14:return u=t.sent,t.next=17,this.database.setEntity(qt);case 17:return i=it().entities.find((function(t){return t.name===a.entity.type})),t.abrupt("return",[pt(u,i),a.entity.type]);case 21:return t.prev=21,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",!1);case 25:case"end":return t.stop()}}),t,this,[[0,21]])}))),function(t){return r.apply(this,arguments)})},{key:"register",value:(e=f(b.mark((function t(e,r,n){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.database.setEntity(qt);case 3:return t.next=5,this.database.insert({token:n,entity:{type:r,id:e}});case 5:return t.abrupt("return",!0);case 9:return t.prev=9,t.t0=t.catch(0),logger(t.t0),t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(t,r,n){return e.apply(this,arguments)})},{key:"generate",value:function(){return s.randomBytes(64).toString("hex")}}]),t}();function Jt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return Wt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wt(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function Wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var zt=E(D.ROUTES.LOGIN,2),Kt=zt[0],Xt=zt[1];(new G).use(Kt,Xt,function(){var t=f(b.mark((function t(e,r){var n,a,o,u,s,c,f,l,p,h,d,v,y,g,m;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=kt.get(e.server.database),a=CONSTANTS.SERVER.SETTINGS.DATABASE.DEFAULT,t.prev=2,f=null,l=null,p=Jt(it().entities),t.prev=6,d=b.mark((function t(){var r,a,o;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("object"!==w((r=h.value).auth)){t.next=9;break}return t.next=4,n.setEntity(r.name);case 4:return a=Object.keys(e.body).reduce((function(t,n){var a,o;return null!=r&&null!==(a=r.auth)&&void 0!==a&&null!==(o=a.fields)&&void 0!==o&&o.includes(n)&&(t[n]=e.body[n]),t}),{}),t.next=7,n.find(a);case 7:(o=t.sent)&&Object.keys(o).length>0&&(f=o,l=r);case 9:case"end":return t.stop()}}),t)})),p.s();case 9:if((h=p.n()).done){t.next=13;break}return t.delegateYield(d(),"t0",11);case 11:t.next=9;break;case 13:t.next=18;break;case 15:t.prev=15,t.t1=t.catch(6),p.e(t.t1);case 18:return t.prev=18,p.f(),t.finish(18);case 21:if(f&&l){t.next=23;break}return t.abrupt("return",r.code(401));case 23:return null!==(o=l)&&void 0!==o&&null!==(u=o.auth)&&void 0!==u&&u.secret&&(a=l.auth.secret),v=new Yt(e),y=ct(f),g=v.generate(),m="jwt"!==(null===(s=l)||void 0===s||null===(c=s.auth)||void 0===c?void 0:c.type)?g:i.sign({access:g,id:y},a),t.next=30,v.register(y,l.name,m);case 30:return r.setHeader("x-auth-token",m),t.abrupt("return",r.json(O({},l.name,pt(f,l))));case 34:return t.prev=34,t.t2=t.catch(2),logger(t.t2),t.abrupt("return",r.code(500));case 38:return t.abrupt("return",!1);case 39:case"end":return t.stop()}}),t,null,[[2,34],[6,15,18,21]])})));return function(e,r){return t.apply(this,arguments)}}()),new P(k.REQUEST.BEFORE.PROCESS).set(function(){var t=f(b.mark((function t(e,r){var n,a,o,u,i,s,c,f,l,p,h,d,v,y,g;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=it(),a=n.entities,o=e.url.split("/"),u=e.url.split("?"),i=E(u,2),s=i[0],c=void 0===s?"":s,f=i[1],l=void 0===f?"":f,e.url={value:e.url,base:c,splitted:o.filter((function(t){return t.length>0})),params:l.split("&").reduce((function(t,e){var r=E(e.split("="),2),n=r[0],a=r[1];return t[n]=a,t}),{})},e.entity=a.find((function(t){return t.name===e.url.splitted[0]}))||!1,!G.inWhitelist(e)){t.next=7;break}return t.abrupt("return",!1);case 7:if(void 0!==(p=e.headers["x-auth-token"]||e.headers.authorization)){t.next=10;break}return t.abrupt("return",r.code(401));case 10:return h=new Yt(e),t.next=13,h.validate(p);case 13:d=t.sent,v=E(d,2),y=v[0],g=v[1],e.auth=y,e.entity=a.find((function(t){return t.name===g}))||!1;case 19:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}());var Zt=function(t,e){return function(r){var n=r.url.splitted.filter((function(t){return t.length>0}));return r.method===CONSTANTS.SERVER.METHODS[t]&&e(n.length)}},te={delete:Zt("DELETE",(function(t){return 2===t})),update:Zt("UPDATE",(function(t){return 2===t})),insert:Zt("INSERT",(function(t){return 1===t})),list:Zt("LIST",(function(t){return 1===t})),get:Zt("GET",(function(t){return 2===t})),oldest:function(t){var e,r;return(null==t||null===(e=t.url)||void 0===e||null===(r=e.value)||void 0===r?void 0:r.search("oldest"))>-1&&(null==t?void 0:t.method)===CONSTANTS.SERVER.METHODS.GET},latest:function(t){var e,r;return(null==t||null===(e=t.url)||void 0===e||null===(r=e.value)||void 0===r?void 0:r.search("latest"))>-1&&(null==t?void 0:t.method)===CONSTANTS.SERVER.METHODS.GET}};function ee(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function re(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ee(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}new P(k.REQUEST.BEFORE.PROCESS).set(function(){var t=f(b.mark((function t(e,r){var n,a,o,u,i,s,c,f,l,p,h,d,v,y,g,m,S;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=CONSTANTS.SERVER.AUTH,u=o.PERMISSIONS,i=o.PERMISSIONS_BY_METHODS,s={oldest:u.LIST,latest:u.LIST,update:u.UPDATE,delete:u.DELETE,insert:u.INSERT,list:u.LIST,get:u.GET},!1!==it().entities.filter((function(t){return"object"===w(t.auth)})).length>0){t.next=5;break}return t.abrupt("return",!1);case 5:if(c=null===(n=Object.keys((null==e||null===(a=e.entity)||void 0===a?void 0:a.permission)||{}))||void 0===n?void 0:n.filter((function(t){var r;return!0===(null===(r=e.entity)||void 0===r?void 0:r.permission[t])})),f=!(null==c||!c.find((function(t){return i[e.method].includes(t)}))),!f&&!G.inWhitelist(e)){t.next=9;break}return t.abrupt("return",!1);case 9:l=0,p=Object.keys(te);case 10:if(!(l<p.length)){t.next=24;break}if(h=p[l],!te[h](e)){t.next=21;break}if(!(y=null===(d=e.entity)||void 0===d||null===(v=d.auth)||void 0===v?void 0:v.permission)){t.next=21;break}if(g=s[h]||u.LIST,m=y[e.entity.name]||y["*"],S=!!e.auth,!!!m[g]||!S){t.next=21;break}return t.abrupt("return",!1);case 21:l++,t.next=10;break;case 24:return t.abrupt("return",r.code(401));case 25:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}());var ne=new G;function ae(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object.keys(t).reduce((function(r,n){return t[n].secure&&e?r:re(re({},r),{},O({},n,t[n].type||t[n]))}),{})}ne.use(I.ROUTES.DOCS,function(){var r=f(b.mark((function r(n,a){var o,u,i,s,c;return b.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=null===(o=t.parse(n.url.base))||void 0===o?void 0:o.ext,a.setHeader("Content-Type",N[u||".html"]),"/"===n.url.base.slice(-1)||u){r.next=6;break}return i=ht(n,n.url.base),a.setHeader("Location",i),r.abrupt("return",a.code(301));case 6:return s=t.normalize(n.url.base).replace("/system/docs",""),c=["","/"].includes(s)?"index.html":s,a.payload=e.readFileSync(t.join(__dirname,"files",c)),r.abrupt("return",!0);case 10:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}()),ne.use(I.ROUTES.API,function(){var t=f(b.mark((function t(e,r){var n,a,o;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=it(),a=[],o=n.entities.map((function(t){if(t.auth){var e=t.auth.fields.reduce((function(e,r){return re(re({},e),{},O({},r,t.fields[r]))}),{});a.push({entity:t.name,alias:t.alias||!1,type:t.auth.type,response:ae(t.fields),fields:ae(e,!1)})}return{name:t.name,alias:t.alias||!1,fields:t.fields}})),r.json({docs:{name:n.name,label:n.label,host:ht(e),entities:o,auth:a}}),t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}());var oe={SEARCH:["GET","/system/search"],SYSTEM:["GET","/system"],HOME:["GET","/"]},ue=E(oe.SEARCH,2),ie=ue[0],se=ue[1];(new G).use(ie,se,{public:!1},function(){var t=f(b.mark((function t(e,r){var n,a,o,u,i,s,c,f;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Object.keys(e.url.params).length){t.next=2;break}return t.abrupt("return",r.status(422));case 2:return n=e.url.params,a=n.query,o=n.search,u=n.s,i=n.q,s=a||o||u||i,c=kt.get(e.server.database),t.next=7,c.setEntity(e.entity.name);case 7:return t.next=9,c.search(s);case 9:return f=t.sent,t.abrupt("return",r.json({records:f}));case 11:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}());for(var ce=new G,fe=function(){var t=f(b.mark((function t(e,r){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.json({message:"API Running",documentation:CONSTANTS.SERVER.DOCS.ROUTES.DOCS.replace("*","")}));case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),le=0,pe=[oe.HOME,oe.SYSTEM];le<pe.length;le++){var he=E(pe[le],2),de=he[0],ve=he[1];ce.use(de,ve,fe)}function ye(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function be(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return ge(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ge(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function ge(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var me=function(){function t(e){var r=e.config;l(this,t),this.servers=[];var n,a=be(st(r));try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.type===CONSTANTS.SERVER.TYPES.REST){var u=new Qt(this.getConfigData(o));this.servers.push(u)}}}catch(t){a.e(t)}finally{a.f()}return this.servers}return h(t,[{key:"getConfigData",value:function(t){var e=E(st(it().database),1)[0],r=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ye(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t);return r.database||(r.database=(null==e?void 0:e.key)||CONSTANTS.SERVER.SETTINGS.DATABASE.DEFAULT),r}}]),t}(),Se=function(){function t(e){l(this,t),this.json=e,this.name=e.name,this.routes=new G,global["json-server"]=e,global.logger=e.logger||console.log}var e;return h(t,[{key:"setup",value:function(t){var e=t.request,r=t.database,n=t.language;e.limit&&(CONSTANTS.SERVER.SETTINGS.REQUEST.LIMIT=e.limit),null!=r&&r.default&&(CONSTANTS.SERVER.SETTINGS.DATABASE.DEFAULT=r.default),n&&(CONSTANTS.SETTINGS.LANGUAGE.DEFAULT=n)}},{key:"run",value:(e=f(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{this.databases=new kt(this.json),this.servers=new me(this.json)}catch(t){logger(t)}case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getServerByPort",value:function(t){return this.servers.find((function(e){return e.port===t}))}}]),t}();export{Se as default};
